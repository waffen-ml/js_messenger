extends index

include ../client_modules/chatsettings/index

append header
    script(src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js")
    style 
        include css/chat.css
        include css/usercontent.css
append body 
    script 
        include js/chat.js

block main
    .chat-header.block 
        .info(onclick='alert("options")')
            img.avatar
            span.chat-name.finite
            span.subinfo.finite
        button.button.dots ...

    .voice-chat.block(style="display:none;")
        .preview
            span.list.finite –í –∑–≤–æ–Ω–∫–µ:
            span.count 0 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

    .holder-wrapper.block.styled-scroll
        .load-zone
        .holder
    .reply-bar.block(style="display:none;")
        .reply-to-msg
            span.user-name Lorem ipsum dolor sit amet.
            span.msg-text Lorem ipsum dolor sit amet.
        button.button.discard üóëÔ∏è
    .input-bar
        .block.audio-record-bar
            b –ó–∞–ø–∏—Å—å: 
            span.finite 0 —Å–µ–∫—É–Ω–¥
        textarea.entry(placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ")
        button.button#stickers üòÄ 
        button.button#file üìÅ
        button.button#record üé§
        button.button#discard-audio üóëÔ∏è
        button.button#send-audio ‚úÖÔ∏è
        button.button#send üì®
    
    script(type="text/x-ejs-template", template="stickerscw")
        .grid.emojis#emoji.styled-scroll
                <% emojiList.forEach((emoji, i) => { %>
                button.button.emoji <%=emoji%>
                <% }) %>
        
        <% packs.forEach(pack => { %>
        .grid.stickers(id!="<%=pack.tag%>").disabled.styled-scroll
            <% for(let i = 0; i < pack.count; i++) { %>
            button.button.sticker(id!="<%=i%>")
                img(src!="/public/stickers/<%=pack.tag%>/<%=i%>.png")
            <% } %>
        <% }) %>
        hr
        .navigation
            button.button#emoji üòÄ
            <% packs.forEach(pack => { %>
            button.button(id!="<%=pack.tag%>")
                img.preview(src!="/public/stickers/<%=pack.tag%>/0.png")
            <% }) %>
            button.button#buy +
    
    script(type="text/x-ejs-template", template="chat-popup")
        a.chat-link.block(href!="https://coffeetox.ru/chat?id=<%=chatid%>") –°—Å—ã–ª–∫–∞: https://coffeetox.ru/chat?id=<%=chatid%>
        .actions
            <% if (admin || direct) { %>
            a.button.delete-chat –£–¥–∞–ª–∏—Ç—å —á–∞—Ç
            <% }; %>
            a.button.clear-history –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
            <% if (!direct) { %>
            a.button.leave-chat –í—ã–π—Ç–∏ –∏–∑ —á–∞—Ç–∞
            <% }; %>
            <% if (admin && !direct) { %>
            a.button.add-members –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            <% }; %>
        .tab-view
            .block.controls
                a.button#show-members –£—á–∞—Å—Ç–Ω–∏–∫–∏
                a.button#show-media –ú–µ–¥–∏–∞
                a.button#show-audio –ê—É–¥–∏–æ
                a.button#show-other –î—Ä—É–≥–æ–µ
            .tab.styled-scroll#members
                .flex-holder
            .tab.styled-scroll#media 
                .grid-holder(inspect-group="1")
            .tab.styled-scroll#audio 
                .flex-holder
            .tab.styled-scroll#other 
    
    script(type="text/x-ejs-template", template="chat-memberlist-item")
        a.button.light.member(href!="/user?id=<%=id%>", class!="<%= utils.classAttr({admin: admin, 'can-delete': canDelete}) %>") 
            img.avatar(src!="/getuseravatar?id=<%=id%>")
            .top-bar 
                span.name.finite <%=name%>
                span.admin-label (–∞–¥–º–∏–Ω)
            span.last-seen <%= utils.getLastSeenStatus(lastSeen) %>
            button.button.delete-member üóëÔ∏è            
    
    script(type="text/x-ejs-template", template="chat-audiolist-item")
        .audiofile
            span.filename <%=name%>
            audio(controls)
                source(src!="/file?id=<%=id%>")

    script(type="text/x-ejs-template", template="chat-medialist-item")
        .visual-wrapper(class!="<%=mimetype%>")
            <% if (mimetype == 'image') { %>
            img(src!="/file?id=<%=id%>")
            <% } else { %>
            video(src!="/file?id=<%=id%>", preload="metadata") 
            <% }; %>